<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>BocheCrawler v0.8.3 — Mini Playable</title>
<style>
body{margin:0;background:#0c0c10;color:#eee;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
.wrap{max-width:900px;margin:0 auto;padding:12px}
.top{display:flex;align-items:center;justify-content:space-between;gap:8px}
.pill{padding:4px 8px;border:1px solid #2b2b34;border-radius:999px;font-size:12px;color:#bdb8ae;background:#14141a}
.btn{background:#1b1b22;border:1px solid #33384a;color:#eee;font-weight:800;border-radius:12px;padding:8px 12px;font-size:13px}
.btn:disabled{opacity:.5}
.area{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
.panel{background:#101017;border:1px solid #2a2a33;border-radius:14px;padding:10px}
.sprite{height:160px;border-radius:12px;background:linear-gradient(#1a1a21,#0f0f15);display:flex;align-items:center;justify-content:center}
.hp{height:12px;border:1px solid #2a2a33;border-radius:8px;background:#17171d;overflow:hidden;margin-top:6px}
.hp>i{display:block;height:100%;background:linear-gradient(90deg,#e87070,#b14141)}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.tray{grid-column:1/span 2;display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.die{width:180px;background:#13131a;border:1px solid #2a2a33;border-radius:12px;padding:8px}
.cardbar{grid-column:1/span 2;display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;min-height:120px}
.card{width:150px;background:#15151c;border:1px solid #2a2a33;border-radius:12px;padding:8px;text-align:left;position:relative}
.card .cost{position:absolute;right:6px;top:6px;border:1px solid #2a2a33;border-radius:8px;padding:2px 6px}
.name{font-weight:800}
.desc{font-size:12px;color:#bdb8ae}
.log{grid-column:1/span 2;font-size:12px;color:#bdb8ae;border-top:1px dashed #2a2a33;margin-top:8px;padding-top:6px;max-height:120px;overflow:auto}
@media(max-width:820px){.area{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div class="row">
      <span class="pill">Cave <b id="cave">1</b></span>
      <span class="pill">Beast <b id="beast">1/3</b></span>
      <span class="pill">Teeth 🦷 <b id="teeth">0</b></span>
      <span class="pill">Hands <b id="hands">4</b></span>
      <span class="pill">Energy <b id="energy">3</b></span>
    </div>
    <div class="row">
      <button class="btn" id="btnNew">New Run</button>
    </div>
  </div>

  <div class="area">
    <div class="panel">
      <div class="sprite" id="enemyArt">
        <!-- simple beast -->
        <svg viewBox="0 0 200 120" width="90%" height="90%">
          <rect width="200" height="120" fill="#111219"/>
          <path d="M20,100 Q80,70 110,92 T190,96 L190,120 L20,120 Z" fill="#0c0c12"/>
          <path d="M70,95 C95,70 120,55 145,60 C165,64 178,86 185,97 L165,97 C154,82 145,75 135,77 120,80 110,89 98,96 Z" fill="#1a1a22"/>
          <circle cx="140" cy="76" r="6" fill="#b34a4a"/><circle cx="127" cy="75" r="5" fill="#d8d0c0"/>
        </svg>
      </div>
      <div class="hp"><i id="ehpFill" style="width:100%"></i></div>
      <div class="row" style="justify-content:space-between">
        <span class="pill">Omen: <b id="omen">—</b></span>
        <span class="pill">HP <b id="ehp">40</b>/<b id="ehpM">40</b></span>
      </div>
    </div>

    <div class="panel">
      <div class="sprite" id="heroArt">
        <svg viewBox="0 0 200 120" width="90%" height="90%">
          <rect width="200" height="120" fill="#0f0f15"/>
          <path d="M20,100 L180,100" stroke="#21212a" stroke-width="8"/>
          <path d="M80,96 C90,70 104,52 120,52 136,52 150,78 156,96 Z" fill="#1a1a22"/>
          <rect x="106" y="46" width="22" height="10" fill="#242432" transform="rotate(-15 117 51)"/>
          <rect x="134" y="70" width="24" height="14" fill="#242432" transform="rotate(15 146 77)"/>
          <circle cx="124" cy="62" r="4.5" fill="#e6dece"/>
        </svg>
      </div>
      <div class="row" style="justify-content:space-between">
        <span class="pill">Gravegrit: <b id="grit">0</b></span>
        <span class="pill">Oathfire: <b id="oath">0</b>x</span>
      </div>
      <div class="row">
        <button class="btn" id="btnRoll">Roll</button>
        <button class="btn" id="btnResolve" disabled>Resolve</button>
        <button class="btn" id="btnEnd" disabled>End Hand</button>
      </div>
    </div>

    <div class="tray" id="tray"></div>

    <div class="row" style="justify-content:space-between; grid-column:1/span 2">
      <div class="row">
        <span class="pill">Draw <b id="draw">0</b></span>
        <span class="pill">Rerolls <b id="rer">1</b></span>
      </div>
    </div>

    <div class="cardbar" id="hand"></div>

    <div class="log" id="log"></div>
  </div>
</div>

<script>
const $=id=>document.getElementById(id);
const L=t=>{const p=document.createElement('div');p.textContent=t;$('log').prepend(p)};
const R=n=>Math.floor(Math.random()*n);

const FACE=[{k:'SWORD',i:'⚔️'},{k:'SHIELD',i:'🛡️'},{k:'EYE',i:'👁️'},{k:'HEX',i:'☠️'}];
const DICE_LIBRARY=[
  {name:'Initiate Die',faces:[0,0,1,2,3,1],effect:'fury_eye',val:.25,rarity:'common'},
  {name:'Blessed Cube',faces:[0,1,1,2,0,1],effect:'flat_grit',val:6,rarity:'uncommon'},
  {name:'Omen-Carved',faces:[0,0,3,0,2,3],effect:'grit_hex',val:8,rarity:'uncommon'},
];
const CARDS={
  'Lunge':{c:1,d:'+20 Grit',p:G=>G.turn.grit+=20},
  'Guard':{c:1,d:'+10 Grit & +1 reroll',p:G=>{G.turn.grit+=10;G.turn.rerolls++}},
  'Focus':{c:1,d:'+0.3 Oathfire',p:G=>G.turn.oath+=.3},
  'Bone Toss':{c:1,d:'+10 Grit, draw 1',p:G=>{G.turn.grit+=10;G.turn.drawNext++}},
  'Bone Storm':{c:2,d:'+40 Grit, draw 2',p:G=>{G.turn.grit+=40;G.turn.drawNext+=2}},
  'Blood Oath':{c:3,d:'+1.5 Oathfire +40 Grit',p:G=>{G.turn.oath+=1.5;G.turn.grit+=40}},
};

const G={cave:1,beast:0,teeth:0,handsMax:4,hands:4,energy:3,
  enemy:{hp:40,hm:40,dr:0}, dice:[], draw:[], hand:[], discard:[],
  turn:{grit:0,oath:0,rerolls:1,drawNext:0}
};

function starterDeck(){return ['Lunge','Lunge','Lunge','Guard','Focus','Bone Toss','Bone Storm','Blood Oath']}

function ui(){
  $('cave').textContent=G.cave; $('beast').textContent=(G.beast+1)+'/3';
  $('teeth').textContent=G.teeth; $('hands').textContent=G.hands;
  $('energy').textContent=G.energy; $('grit').textContent=Math.round(G.turn.grit);
  $('oath').textContent=G.turn.oath.toFixed(2); $('ehp').textContent=G.enemy.hp;
  $('ehpM').textContent=G.enemy.hm; $('ehpFill').style.width=(G.enemy.hp/G.enemy.hm*100)+'%';
  $('draw').textContent=G.draw.length; $('rer').textContent=G.turn.rerolls;
}

function renderDice(){
  const t=$('tray'); t.innerHTML='';
  G.dice.forEach(d=>{
    const el=document.createElement('div'); el.className='die';
    const f=d.current!=null?FACE[d.current].i:'—';
    el.innerHTML=`<b>${d.name}</b><div>Face: <b>${f}</b></div>`;
    t.appendChild(el);
  });
}

function renderHand(){
  const h=$('hand'); h.innerHTML='';
  if(!G.hand.length){const tip=document.createElement('div');tip.textContent='(No cards)';h.appendChild(tip);return}
  G.hand.forEach((n,i)=>{
    const c=CARDS[n]; const b=document.createElement('button'); b.className='card';
    b.innerHTML=`<div class="cost">${c.c}</div><div class="name">${n}</div><div class="desc">${c.d}</div>`;
    b.disabled=G.energy<c.c; b.onclick=()=>playCard(i);
    h.appendChild(b);
  });
}

function newRun(){
  G.cave=1; G.beast=0; G.teeth=0; G.hands=G.handsMax; G.energy=3;
  G.enemy={hp:40,hm:40,dr:0};
  G.dice=[JSON.parse(JSON.stringify(DICE_LIBRARY[0])),JSON.parse(JSON.stringify(DICE_LIBRARY[1])),JSON.parse(JSON.stringify(DICE_LIBRARY[2]))];
  G.draw=shuffle(starterDeck()); G.hand=[]; G.discard=[];
  G.turn={grit:0,oath:0,rerolls:1,drawNext:0};
  drawTo(5); renderDice(); ui(); L('— New run started —');
}

function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}

function drawTo(n){
  while(G.hand.length<n){
    if(!G.draw.length){G.draw=shuffle(G.discard); G.discard=[]}
    if(!G.draw.length)break;
    G.hand.push(G.draw.pop());
  }
  ui(); renderHand();
}

function playCard(i){
  const name=G.hand[i]; const c=CARDS[name];
  if(G.energy<c.c)return;
  G.energy-=c.c; c.p(G);
  const used=G.hand.splice(i,1)[0]; G.discard.push(used);
  if(G.turn.drawNext>0){ drawTo(Math.min(5,G.hand.length+G.turn.drawNext)); G.turn.drawNext=0; }
  ui(); renderHand();
}

function roll(){
  if(G.turn.rerolls<=0){L('No rerolls left.');return}
  let fury=0, grit=0;
  G.dice.forEach(d=>{
    d.current = d.faces[R(6)];
    const f=FACE[d.current].k;
    if(d.effect==='fury_eye' && f==='EYE')fury+=d.val;
    if(d.effect==='flat_grit')grit+=d.val;
    if(d.effect==='grit_hex' && f==='HEX')grit+=d.val;
  });
  G.turn.oath+=fury; G.turn.grit+=grit; G.turn.rerolls--;
  $('btnResolve').disabled=false; $('btnEnd').disabled=false;
  renderDice(); ui();
  L(`Rolled → +${Math.round(grit)} grit, +${fury.toFixed(2)} oathfire.`);
}

function resolve(){
  const raw = Math.round(G.turn.grit*(1+G.turn.oath));
  G.enemy.hp = Math.max(0, G.enemy.hp - raw);
  L(`Resolve → ${Math.round(G.turn.grit)} × (1+${G.turn.oath.toFixed(2)}) = ${raw} damage.`);
  endHand(true);
}

function endHand(afterResolve=false){
  G.hands=Math.max(0,G.hands-1);
  G.turn={grit:0,oath:0,rerolls:1,drawNext:0};
  G.energy=3; $('btnResolve').disabled=true; $('btnEnd').disabled=true;
  drawTo(5); ui();
  if(afterResolve && G.enemy.hp<=0){ L('Beast defeated! New beast.'); G.enemy={hp:40,hm:40,dr:0}; ui(); }
}

function init(){
  $('btnNew').onclick=newRun;
  $('btnRoll').onclick=()=>{roll();};
  $('btnResolve').onclick=resolve;
  $('btnEnd').onclick=()=>endHand(false);
  newRun();
}
init();
</script>
</body>
</html>
